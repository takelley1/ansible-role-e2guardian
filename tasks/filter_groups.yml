---

# Deploy customized filer lists based on the groups defined in the e2g_filter_groups variable.

- name: FILTER_GROUPS | Set filter group file index.
  set_fact:
    index: "{{ (item_index + 1) | string }}"

# Setting a fact that depends on another fact must be defined separately.
- name: FILTER_GROUPS | Set filter group file name.
  set_fact:
    filter_group_file: "{{ 'e2guardianf' + index }}"

- name: FILTER_GROUPS | Filter group configuration file created
  ansible.builtin.template:
    src: opt/e2g/etc/e2guardian/e2guardianfn.conf.j2
    dest: "{{ ((e2g_install_dir, 'etc', 'e2guardian', filter_group_file) | path_join) + '.conf' }}"
  notify: restart-e2guardian

# ------------------------------------------------------------------------------

- name: FILTER_GROUPS | banned_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_phraselist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_phraselist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_phraselist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_phraselist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | weighted_phraselist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.weighted_phraselist.name) | path_join }}"
    content: |
      {%- for site in item.lists.weighted_phraselist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.weighted_phraselist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_phraselist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_phraselist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_phraselist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_phraselist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_useragent_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_useragent_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_useragent_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_useragent_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_ssl_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_ssl_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_ssl_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_ssl_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_ssl_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_ssl_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_ssl_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_ssl_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | grey_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.grey_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.grey_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.grey_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | grey_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.grey_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.grey_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.grey_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | grey_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.grey_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.grey_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.grey_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | grey_ssl_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.grey_ssl_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.grey_ssl_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.grey_ssl_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | grey_ssl_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.grey_ssl_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.grey_ssl_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.grey_ssl_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_useragent_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_useragent_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_useragent_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_useragent_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | reference_exception_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.reference_exception_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.reference_exception_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.reference_exception_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | reference_exception_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.reference_exception_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.reference_exception_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.reference_exception_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | reference_exception_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.reference_exception_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.reference_exception_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.reference_exception_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | embeded_reference_exception_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.embeded_reference_exception_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.embeded_reference_exception_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.embeded_reference_exception_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | embeded_reference_exception_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.embeded_reference_exception_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.embeded_reference_exception_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.embeded_reference_exception_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | embeded_reference_exception_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.embeded_reference_exception_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.embeded_reference_exception_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.embeded_reference_exception_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | modification_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.modification_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.modification_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.modification_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | modification_ssl_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.modification_ssl_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.modification_ssl_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.modification_ssl_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | redirect_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.redirect_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.redirect_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.redirect_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | redirect_contentregexplist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.redirect_contentregexplist.name) | path_join }}"
    content: |
      {%- for site in item.lists.redirect_contentregexplist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.redirect_contentregexplist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | local_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.local_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.local_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.local_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | local_searchlist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.local_searchlist.name) | path_join }}"
    content: |
      {%- for site in item.lists.local_searchlist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.local_searchlist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | local_grey_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.local_grey_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.local_grey_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.local_grey_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | local_grey_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.local_grey_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.local_grey_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.local_grey_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | local_exception_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.local_exception_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.local_exception_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.local_exception_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | fileextlist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.fileextlist.name) | path_join }}"
    content: |
      {%- for site in item.lists.fileextlist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.fileextlist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | mimelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.mimelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.mimelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.mimelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_file_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_file_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_file_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_file_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_file_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_file_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_file_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_file_ipsitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_file_urllist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_file_urllist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_file_urllist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_file_urllist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | header_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.header_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.header_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.header_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_header_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_header_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_header_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_header_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | exception_header_regexpboollist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.exception_header_regexpboollist.name) | path_join }}"
    content: |
      {%- for site in item.lists.exception_header_regexpboollist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.exception_header_regexpboollist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | add_header_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.add_header_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.add_header_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.add_header_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | search_regexpreplacelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.search_regexpreplacelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.search_regexpreplacelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.search_regexpreplacelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_searchlist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_searchlist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_searchlist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_searchlist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | override_searchlist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.override_searchlist.name) | path_join }}"
    content: |
      {%- for site in item.lists.override_searchlist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.override_searchlist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | banned_bypass_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.banned_bypass_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.banned_bypass_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.banned_bypass_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | nocheckcert_sitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.nocheckcert_sitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.nocheckcert_sitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.nocheckcert_sitelist.name is defined
  notify: restart-e2guardian

- name: FILTER_GROUPS | nocheckcert_ipsitelist filter group file created
  ansible.builtin.copy:
    dest: "{{ (e2g_filter_groups_dir, item.lists.nocheckcert_ipsitelist.name) | path_join }}"
    content: |
      {%- for site in item.lists.nocheckcert_ipsitelist.content %}
      {{ site }}
      {% endfor -%}
  when: item.lists.nocheckcert_ipsitelist.name is defined
  notify: restart-e2guardian
